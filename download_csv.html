<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(to bottom, #3494e6, #ec6ead);
            color: #fff;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .container {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        h1 {
            color: #333;
        }

        .buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .button {
            background-color: #ff5733;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .button:hover {
            background-color: #ff8040;
        }
    </style>

</head>

<body>
    <div class="container">
        <h1>Download Sections</h1>
        <div class="buttons">
            <button class="button" id="noSurvey">No survey</button>
            <button class="button" id="download">Download all data</button>
            <button class="button" id="deleteButton">Delete All Data</button>


        </div>
    </div>



    <script>


        document.getElementById('noSurvey').addEventListener('click', function () {
            // Create a header row with column names
            const headerRow = ['Latitude', 'Longitude', 'DateTime'];

            // Filter and map the formData to exclude rows with empty values
            const filteredData = formData.filter(row => (
                row.LatitudeNo !== undefined && row.LongitudeNo !== undefined && row.DateTimeNo
            ));

            // Combine the header row and filtered data rows
            const csvData = [headerRow, ...filteredData.map(row => [row.LatitudeNo, row.LongitudeNo, row.DateTimeNo])];

            // Create a CSV string
            const csvContent = "data:text/csv;charset=utf-8," + csvData.map(row => row.join(',')).join('\n');

            // Create a download link and trigger the download
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', 'No_survey-data.csv');
            document.body.appendChild(link);
            link.click();
        });

        document.getElementById('download').addEventListener('click', function () {
            const filteredData = formData.filter(row => (
                row.Ename !== undefined
            ));

            // Create a header row with column names
            const headerRow = ['Ename', 'Route', 'Gender', 'Age', 'Income', 'Employment', 'Education', 'OriginArea', 'OriginPin', 'DestinationArea', 'DestinationPin', 'City', 'DateTime', 'Q9', 'Q10', 'Q11', 'Q12', 'OriginType', 'StartingTime', 'Duration', 'B-Options', 'WaitingTime', 'C_to_E', 'WaitingTimeE', 'DurationF', 'F_options', 'DestinationType', 'EndTime', 'Q13i', 'Q13s', 'Q14i', 'Q14s', 'Q15i', 'Q15s', 'Q16i', 'Q16s', 'Q17i', 'Q17s', 'Q18i', 'Q18s', 'Q19i', 'Q19s', 'Q20i', 'Q20s', 'Q21i', 'Q21s', 'Q22i', 'Q22s', 'Q23i', 'Q23s', 'Q24i', 'Q24s', 'Q25i', 'Q25s', 'Q26i', 'Q26s', 'Q27i', 'Q27s', 'Q28i', 'Q28s', 'Q29i', 'Q29s', 'Q30i', 'Q30s', 'Q31i', 'Q31s', 'Q32i', 'Q32s', 'Q33i', 'Q33s', 'fQ13i', 'fQ13s', 'fQ14i', 'fQ14s', 'fQ15i', 'fQ15s', 'fQ16i', 'fQ16s', 'fQ17i', 'fQ17s', 'fQ18i', 'fQ18s', 'fQ19i', 'fQ19s', 'fQ20i', 'fQ20s', 'fQ21i', 'fQ21s', 'fQ22i', 'fQ22s', 'fQ23i', 'fQ23s', 'fQ24i', 'fQ24s', 'fQ25i', 'fQ25s', 'fQ26i', 'fQ26s', 'fQ27i', 'fQ27s', 'fQ28i', 'fQ28s', 'fQ29i', 'fQ29s', 'fQ30i', 'fQ30s', 'fQ31i', 'fQ31s', 'fQ32i', 'fQ32s', 'fQ33i', 'fQ33s', 'Q34', 'Q35', 'Q36', 'Q37', 'Q38', 'Q39', 'Q40', 'Q40_a', 'Q40_b', 'Smart_Phone', 'Data_Package', 'Q41', 'Q42', 'Q43', 'Q44', 'Q45'];

            // Combine the header row and data rows
            const csvData = [headerRow, ...formData.map(row => [row.Ename, row.Route, row.Gender, row.Age, row.Income, row.Employment, row.Education, row.OriginArea, row.OriginPin, row.DestinationArea, row.DestinationPin, row.City, row.DateTime, row.TravelWork, row.TravelPartner, row.TravelPurpose, row.Travel11, row.OriginType, row.StartingTime, row.Duration, row.Transportation, row.WaitingTime, row.CToe, row.WaitingTimeE, row.Durationf, row.Ftransportation, row.DestinationType, row.EndTime, row.Q13i, row.Q13s, row.Q14i, row.Q14s, row.Q15i, row.Q15s, row.Q16i, row.Q16s, row.Q17i, row.Q17s, row.Q18i, row.Q18s, row.Q19i, row.Q19s, row.Q20i, row.Q20s, row.Q21i, row.Q21s, row.Q22i, row.Q22s, row.Q23i, row.Q23s, row.Q24i, row.Q24s, row.Q25i, row.Q25s, row.Q26i, row.Q26s, row.Q27i, row.Q27s, row.Q28i, row.Q28s, row.Q29i, row.Q29s, row.Q30i, row.Q30s, row.Q31i, row.Q31s, row.Q32i, row.Q32s, row.Q33i, row.Q33s, row.fQ13i, row.fQ13s, row.fQ14i, row.fQ14s, row.fQ15i, row.fQ15s, row.fQ16i, row.fQ16s, row.fQ17i, row.fQ17s, row.fQ18i, row.fQ18s, row.fQ19i, row.fQ19s, row.fQ20i, row.fQ20s, row.fQ21i, row.fQ21s, row.fQ22i, row.fQ22s, row.fQ23i, row.fQ23s, row.fQ24i, row.fQ24s, row.fQ25i, row.fQ25s, row.fQ26i, row.fQ26s, row.fQ27i, row.fQ27s, row.fQ28i, row.fQ28s, row.fQ29i, row.fQ29s, row.fQ30i, row.fQ30s, row.fQ31i, row.fQ31s, row.fQ32i, row.fQ32s, row.fQ33i, row.fQ33s, row.Q34, row.Q35, row.Q36, row.Q37, row.Q38, row.Q39, row.Q40, row.Q40a, row.Q40b, row.smartphone, row.data_package, row.Q41, row.Q42, row.Q43, row.Q44, row.Q45])];

            // Create a CSV string
            const csvContent = "data:text/csv;charset=utf-8," + csvData.map(row => row.join(',')).join('\n');

            // Create a download link and trigger the download
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', 'All-Scection-data.csv');
            document.body.appendChild(link);
            link.click();
        });


        // Retrieve data from IndexedDB
        function fetchDataFromIndexedDB(callback) {
            const request = window.indexedDB.open('formDataDB', 1);

            request.onerror = function (event) {
                console.error('Database error: ', event.target.errorCode);
            };

            request.onsuccess = function (event) {
                const db = event.target.result;
                const transaction = db.transaction(['formData'], 'readonly');
                const objectStore = transaction.objectStore('formData');

                const getDataRequest = objectStore.getAll();

                getDataRequest.onsuccess = function () {
                    const formData = getDataRequest.result;
                    callback(formData);
                };

                getDataRequest.onerror = function (event) {
                    console.error('Error fetching data: ', event.target.error);
                    callback([]);
                };
            };
        }

        fetchDataFromIndexedDB(function (formData) {
            // Store the data in a variable for use in the download functions
            window.formData = formData;
        });


        // Assuming you have a button with the id "deleteButton" in your HTML
        var deleteButton = document.getElementById('deleteButton');

        deleteButton.addEventListener('click', function () {
            // Prompt the user for confirmation
            var userConfirmation = window.confirm('Are you sure you want to delete all data?');

            if (userConfirmation) {
                // User clicked "Yes," proceed with deleting data

                // Open a connection to the database
                var request = indexedDB.open('formDataDB');

                // Handle database opening success
                request.onsuccess = function (event) {
                    var db = event.target.result;

                    // Create a transaction and get a reference to the object store
                    var transaction = db.transaction(['formData'], 'readwrite');
                    var objectStore = transaction.objectStore('formData');

                    // Open a cursor and delete all records
                    var cursorRequest = objectStore.openCursor();
                    cursorRequest.onsuccess = function (event) {
                        var cursor = event.target.result;
                        if (cursor) {
                            cursor.delete();
                            cursor.continue();
                        }
                    };

                    // Handle the transaction completion
                    transaction.oncomplete = function () {
                        console.log('All data deleted successfully.');
                        db.close();
                    };
                };

                // Handle errors during database opening
                request.onerror = function (event) {
                    console.error('Error opening database:', event.target.error);
                };
            } else {
                // User clicked "No," do nothing
                console.log('Data deletion cancelled.');
            }
        });



        window.oncontextmenu = function () {
            return false; // Disable right-click context menu
        };
    </script>
</body>

</html>
